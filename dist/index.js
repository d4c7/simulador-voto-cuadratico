var updateChoices;window.addEventListener("load",function(){const VoterType=Object.freeze({Leal:"Leal",Flexible:"Flexible",Random:"Random",Blank:"Blank"}),VotingContext=Object.freeze({LowStability:"LowStability",NormalStability:"NormalStability",HighStability:"HighStability"}),IdeologicalDistribution=Object.freeze({gauss:"gauss",bimodgauss:"bimodgauss",uniform:"uniform",leftskew:"leftskew",rightskew:"rightskew"}),IdeologicalDistributionFeatures=((m=[])[IdeologicalDistribution.gauss]={name:"Estabilidad Baja",voterTypeDistribution:[.5,.3,.19,.01],description:"En este contexto, se refiere a una situación en la que las condiciones económicas, políticas y sociales son generalmente positivas y predecibles. Los cambios son graduales y generalmente se anticipan con suficiente antelación. En un escenario de alta estabilidad, los votantes pueden sentirse más seguros y confiados en sus decisiones de voto, y puede haber menos fluctuaciones en las preferencias de voto."},m[IdeologicalDistribution.bimodgauss]={name:"Distribución con Dos Focos",description:"Esta distribución sugiere que hay dos grupos principales de votantes, cada uno centrado alrededor de un punto particular en el espectro ideológico, es decir, hay dos 'picos' en la distribución. Esto puede indicar una sociedad polarizada en la que la mayoría de los votantes se identifican con uno de dos puntos de vista ideológicos opuestos."},m[IdeologicalDistribution.uniform]={name:"Distribución Uniforme",description:"En esta distribución, los votantes están igualmente repartidos a lo largo de todo el espectro ideológico. Esto puede sugerir una sociedad en la que no hay una ideología dominante y los votantes tienen una amplia variedad de puntos de vista."},m[IdeologicalDistribution.leftskew]={name:"Distribución con Tendencia a un Lado",description:"En esta distribución, una mayor cantidad de votantes se concentra hacia un extremo del espectro ideológico. Esto puede sugerir una sociedad en la que una ideología en particular es más popular o aceptada que otras. Este tipo de distribución es asimétrica y tiene un 'sesgo' hacia un lado del espectro."},m[IdeologicalDistribution.rightskew]={name:"Distribución con Tendencia a otro lado",description:"En esta distribución, una mayor cantidad de votantes se concentra hacia un extremo del espectro ideológico. Esto puede sugerir una sociedad en la que una ideología en particular es más popular o aceptada que otras. Este tipo de distribución es asimétrica y tiene un 'sesgo' hacia un lado del espectro."},m);const VotingContextFeatures=function(){var m=[];return m[VotingContext.HighStability]={name:"Estabilidad Alta",voterTypeDistribution:[.5,.3,.19,.01],description:"En este contexto, se refiere a una situación en la que las condiciones económicas, políticas y sociales son generalmente positivas y predecibles. Los cambios son graduales y generalmente se anticipan con suficiente antelación. En un escenario de alta estabilidad, los votantes pueden sentirse más seguros y confiados en sus decisiones de voto, y puede haber menos fluctuaciones en las preferencias de voto."},m[VotingContext.NormalStability]={name:"Estabilidad Normal",voterTypeDistribution:[.3,.4,.25,.05],description:"Este es un escenario intermedio en el que hay cierto grado de incertidumbre y cambio, pero también cierta previsibilidad y continuidad. Las condiciones económicas, políticas y sociales pueden estar en un estado de cambio moderado, y los votantes pueden cambiar sus preferencias de voto en respuesta a estos cambios, pero no necesariamente de manera radical o impredecible."},m[VotingContext.LowStability]={name:"Estabilidad Baja",voterTypeDistribution:[.1,.25,.55,.1],description:"Este es un escenario en el que hay una gran cantidad de incertidumbre y cambio. Las condiciones económicas, políticas y sociales pueden ser volátiles y cambiar rápidamente y de formas impredecibles. En un escenario de baja estabilidad, los votantes pueden sentirse inseguros y confundidos, y las preferencias de voto pueden fluctuar ampliamente."},m}(),VoterTypeFeatures=function(){var m=[];return m[VoterType.Leal]={name:"Leal",rng:.05,novote:.01,minvote:1,maxvote:1,description:"Este votante tiene un fuerte sentido de identidad partidista y siempre vota por el partido que le es más afín (pueden ser varios pero sólo votará a uno generalmente), independientemente de las circunstancias de la elección o los candidatos específicos."},m[VoterType.Flexible]={name:"Flexible",rng:.1,novote:.01,minvote:1,maxvote:4,description:"Este votante tiene varios partidos que considera afines y está dispuesto a votar por cualquiera de ellos, dependiendo de las circunstancias de la elección y de los candidatos específicos. Su voto no es necesariamente para el partido que considera más afín."},m[VoterType.Random]={name:"Volátil",rng:.85,novote:.02,minvote:0,maxvote:100,description:"Este votante no tiene una fuerte identidad partidista y es capaz de votar por una amplia gama de partidos, incluso algunos que no considera particularmente afines. Su elección de voto puede ser muy impredecible y puede estar influenciada por una variedad de factores, incluyendo las cuestiones de la elección, los candidatos específicos, la cobertura mediática y las opiniones de las personas de su entorno."},m[VoterType.Blank]={name:"No voto",rng:.95,novote:.85,minvote:0,maxvote:1,description:"Este votante elige expresamente no votar por ningún partido o candidato y en su lugar emite un voto en blanco. Esto puede ser una protesta contra todas las opciones disponibles, una expresión de descontento con el sistema político en general, o simplemente una elección de no participar activamente en la elección de un candidato o partido."},m}();var circle,dots=[],m=document.getElementById("main").getBoundingClientRect(),width=Math.max(700,m.width),m=Math.max(500,m.height),r=document.getElementById("settings").getBoundingClientRect();const widthSettings=r.width,heightSettings=r.width/1.618,svg=d3.select("#viz").attr("width",width).attr("height",m).style("display","block"),svgSettings=d3.select("#viz-settings").attr("width",widthSettings).attr("height",heightSettings).style("display","block"),scaleX=d3.scaleLinear().domain([0,1]).range([0,width]),scaleY=d3.scaleLinear().domain([0,1]).range([0,m]),scaleXSettings=d3.scaleLinear().domain([0,1]).range([0,widthSettings]),scaleYSettings=d3.scaleLinear().domain([0,1]).range([0,heightSettings]),scaleColor=d3.schemeDark2;var currentForces=[],tooltip=d3.select("body").append("div").attr("id","tooltip").attr("style","position: absolute; opacity: 0;"),simdistrib="gauss",simsize=100;let simcontext=VotingContext.NormalStability;document.getElementById("description");r=document.getElementById("runs"),width=document.getElementById("runq");let simChoiceSelect=document.getElementById("simchoice"),simSizeInput=document.getElementById("simsize"),simContextSelect=document.getElementById("simcontext");var candidates=[{index:.3,id:0},{index:.4,id:1},{index:.6,id:2},{index:.7,id:3}];let simulationBallots,parties=["Opción A","Opción B","Opción C","Opción D","Opción E"];function ticked(){for(circle.attr("cx",d=>d.x).attr("cy",d=>d.y).attr("x",d=>d.x).attr("y",d=>d.y),i=0;i<dots.length;i++){var dot=dots[i];dot.cx=dot.x,dot.cy=dot.y}}function renderGraph(name,data,quadratic=!1,ranknum=0,shape="circle"){const r=d=>quadratic?Math.min(10,0==d.votes.length?data.meta.maxVotes:3+d.votes[ranknum].votes):"circle"==shape?4:8;circle=svg.selectAll("."+name).data(data).join(shape).attr("class",name).attr("voterid",function(d){return d.id}).style("fill",function(d){return 0==d.votes.length?"#2F2D2E":scaleColor[d.votes[ranknum].candidate]}).style("filter","drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.8))").attr("cx",function(d){return scaleX(d.x)}).attr("cy",function(d){return scaleY(d.y)}).attr("x",function(d){return scaleX(d.x)}).attr("y",function(d){return scaleY(d.y)}).attr("width",function(d){return r(d)}).attr("height",function(d){return r(d)}).attr("rx",1).attr("r",function(d){return r(d)}).on("mouseover",function(event,d){tooltip.html(d.text).transition().duration(80).style("display","block").style("opacity",1).style("left",event.pageX+15+"px").style("top",event.pageY-15+"px")}).on("mouseout",function(e){tooltip.style("opacity",0).style("display","none")}).on("click",(event,d)=>{d3.selectAll("[voterid='"+d.id+"']").style("stroke","black").style("opacity",1),d3.selectAll(".viz-shape:not([voterid='"+d.id+"'])").style("opacity",.5).style("stroke","none"),d3.selectAll(".viz-shape-2:not([voterid='"+d.id+"'])").style("opacity",.5).style("stroke","none")})}function clearGraph(savecircles=!1){savecircles||svg.selectAll(".viz-shape").remove(),svg.selectAll(".viz-shape").style("opacity",1),svg.selectAll(".cluster-label").remove(),svg.selectAll(".cluster-number").remove(),svg.selectAll(".toptext").remove(),svg.selectAll(".viz-shape-2").remove(),clearForces()}function clearForces(){for(ind in currentForces)(force=currentForces[ind]).stop();curentForces=[]}function generateForce(data,xcenter,ycenter){return force=d3.forceSimulation(data).force("collide",d3.forceCollide(5).strength(1)).force("forceX",d3.forceX(scaleX(xcenter))).force("forceY",d3.forceY(scaleY(ycenter))).force("charge",d3.forceManyBody().strength(1)).alpha(.4),currentForces.push(force),force}function runRound(data0,roundnum,newy,quadratic){const tot_candidates=data0.meta.candidates.length;if(clearForces(),0==roundnum){clearGraph(savecircles=!0);let force=generateForce(data0,.5,newy);force.stop(),force.on("tick",ticked).restart(),void simulationText("Visualización del electorado y sus mentes","Cada círculo representa un individuo único y su voto principal. Al deslizar el cursor sobre cada uno, se revela la lógica detrás de su decisión de voto, ilustrando su elección en un sistema de votación cuadrática y en un sistema de votación tradicional. Pulsa los botones para ver cómo se reparten los votos en cada uno de los sistemas y cómo cada sistema afecta al resultado final de la votación.")}else{let data=function(data,ranknum){return newdata=[],data.forEach(i=>{for(let r=0;r<ranknum;r++){var il=i.votes.length;0==il?0==r&&newdata.push(i):il>r&&((il=structuredClone(i)).votes=il.votes.slice(r,r+1),newdata.push(il))}}),newdata.meta=structuredClone(data.meta),newdata}(data0,quadratic?tot_candidates:1);const optionVotes=new Array(tot_candidates+1).fill(0),totalVotes=(data.forEach(v=>{if(0==v.votes.length)optionVotes[0]+=quadratic?data.meta.maxVotes:1;else for(let i=0;i<(quadratic?v.votes.length:1);i++)optionVotes[v.votes[i].candidate+1]+=quadratic?v.votes[i].votes:1}),optionVotes.reduce((a,b)=>a+b)),pcVotes=optionVotes.map(v=>v/totalVotes);clearGraph(savecircles=!0),renderGraph("viz-shape-2",data,quadratic,0,"rect");for(let i=0;i<data.length;i++){var dot=data[i],x=0==dot.votes.length?0:dot.votes[0].candidate+1;dot.newx=+x/(tot_candidates+1)}let x_locs=Array.from({length:tot_candidates+1},(_,i)=>i).map(x=>+x/(tot_candidates+1)),all_subset_dots=x_locs.map(x=>data.filter(dot=>dot.newx==x));for(ind in all_subset_dots){var subset_dots=all_subset_dots[ind],x_loc=x_locs[ind];(force=generateForce(subset_dots,x_loc+.1,newy)).stop(),force.on("tick",ticked).restart()}svg.selectAll(".cluster-label").data(all_subset_dots).join("text").attr("class","cluster-label").text((d,i)=>0==i?"En blanco":parties[i-1]).attr("font-weight",(d,i)=>"").attr("text-decoration",(d,i)=>{if(0==all_subset_dots[i].length)return"line-through"}).attr("id",(d,i)=>"cluster-label-"+i).attr("x",(d,i)=>scaleX(x_locs[i]+.1)).attr("y",scaleY(newy+.2)).attr("text-anchor","middle").attr("font-size","15px"),svg.selectAll(".cluster-number").data(all_subset_dots).join("text").attr("class","cluster-number").attr("id",(d,i)=>"cluster-number-"+i).text((d,i)=>"Votos: "+optionVotes[i]+"\n("+(100*pcVotes[i]).toFixed(0)+"%)").attr("x",(d,i)=>scaleX(x_locs[i]+.1)).attr("y",scaleY(newy+.25)).attr("text-anchor","middle").attr("font-size","15px"),svg.selectAll(".cluster-label").transition().duration(500).style("opacity",(d,i)=>0==all_subset_dots[i].length?.1:1),svg.selectAll(".cluster-number").transition().duration(500).style("opacity",(d,i)=>0==all_subset_dots[i].length?.1:1),svg.selectAll(".viz-shape").transition().duration(500).style("opacity",d=>1),quadratic?simulationText("Visualización del voto cuadrático","Los votos están representados por los cuadrados, los distintos tamaños indican el número de votos asignado. Puedes hacer click sobre un votante y ver cómo ha repartido sus votos entre las disitntas opciones."):simulationText("Visualización del voto simple","Cada votante emite un voto representado por un cuadrado")}}function simulationText(t,d){d3.select("#simulation-description").interrupt().style("opacity",1).text(d),d3.select("#simulation-description-title").interrupt().style("opacity",1).text(t)}function gaussianRand(){for(var rand=0,i=0;i<6;i+=1)rand+=Math.random();return rand/6}function assignQuadraticVotes(voteCombinations,distances,preferenceIndices){let bestCombination=null,bestScore=0;for(var votes of voteCombinations)if(!(votes.length<preferenceIndices.length)){let score=0;for(let i=0;i<votes.length;i++){var d=distances[preferenceIndices[i]];0<d&&(score+=votes[i]/d)}score>bestScore&&(bestCombination=votes,bestScore=score)}return bestCombination?bestCombination.slice(0,preferenceIndices.length):[]}function simulate(candidates,size,context){var ballots=[],totalPoints=candidates.length*candidates.length,voteCombinations=function generateQuadraticCombinations(n){var combinations=[];for(let i=1;i<=Math.sqrt(n);i++)if(0<n-i*i){var subCombinations=generateQuadraticCombinations(n-i*i);for(let j=0;j<subCombinations.length;j++)combinations.push([i].concat(subCombinations[j]))}else combinations.push([i]);return combinations}(totalPoints),vcf=VotingContextFeatures[simcontext];for(let idx=0;idx<size;idx++){let sample_index;switch(simdistrib){case"gauss":sample_index=gaussianRand();break;case"bimodgauss":sample_index=Math.random()<.5?.6*gaussianRand():.4+.6*gaussianRand();break;case"leftskew":sample_index=stdlib.base.random.beta(4,2);break;case"rightskew":sample_index=stdlib.base.random.beta(2,4);break;default:sample_index=Math.random()}var voterType=function(options,distribution){var random=Math.random();let acc=0;for(let i=0;i<options.length;i++)if(random<=(acc+=distribution[i]))return options[i]}(Object.keys(VoterType),vcf.voterTypeDistribution);const vtf=VoterTypeFeatures[voterType];var distances=candidates.map(x=>Math.abs(x.index-sample_index)+2*vtf.rng*Math.random());let preferenceIndices=distances.map((e,i)=>({ind:i,val:e})).sort((x,y)=>x.val>y.val?1:x.val==y.val?0:-1).map(e=>e.ind);for(let j=0;j<preferenceIndices.length;j++)if(Math.random()<vtf.novote&&preferenceIndices.splice(j,preferenceIndices.length-j),Math.random()<vtf.rng){!function(array,start){for(let i=array.length-1;i>start;i--){var j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]]}}(preferenceIndices,j);break}var votes=assignQuadraticVotes(voteCombinations,distances,preferenceIndices=1<preferenceIndices.length?preferenceIndices.slice(0,vtf.minvote+Math.random()*(vtf.maxvote-vtf.minvote)):preferenceIndices);let remainingPoints=totalPoints;for(let j=0;j<preferenceIndices.length;j++){var costPoints=votes[j]*votes[j];preferenceIndices[j]={candidate:preferenceIndices[j],points:costPoints,votes:votes[j]},remainingPoints-=costPoints}var affinity=[];for(let j=0;j<candidates.length;j++)affinity.push({candidate:j,distance:distances[j]});voterType={id:ballots.length,voterType:voterType,affinity:affinity.sort((a,b)=>a.distance-b.distance),votes:preferenceIndices,remainingPoints:remainingPoints,totalPoints:totalPoints,x:.5,y:.5};ballots.push(voterType)}return ballots.meta={population:size,candidates:candidates,context:context,totalPoints:totalPoints,maxVotes:Math.sqrt(totalPoints)},ballots}function updateSimulationInit(){var data;updateChoices(),simulationBallots=simulate(candidates,simsize,simcontext),(data=simulationBallots).forEach((d,i)=>{d.x=scaleX(d.x),d.y=scaleY(d.y);let text="<b>Votante "+d.id+"</b>, rationale";var vote;text=(text+="<ul>")+"<li>Tipo: "+VoterTypeFeatures[d.voterType].name+"<p class='description'>"+VoterTypeFeatures[d.voterType].description+"</p></li><li>Afinidad (consciente o no)<ul>",d.affinity.forEach((affinity,i)=>{text+="<li>"+parties[affinity.candidate]+": "+affinity.distance.toFixed(2)+"</li>"}),text=(text+="</ul></li>")+"<li><b>Decisión de voto final</b><ul><li>Sistema de voto simple<ul>",0==d.votes.length?text+="<li>En blanco</li>":(vote=d.votes[0],text+="<li>"+parties[vote.candidate]+"</li>"),text+="</ul></li><li>Sistema de voto cuadrático<ul>",0==d.votes.length?text+="<li> En blanco: "+data.meta.maxVotes+" votos ("+data.meta.totalPoints+" puntos)</li> ":(d.votes.forEach((vote,i)=>{text+="<li> "+parties[vote.candidate]+": "+vote.votes+" voto"+(1<vote.points?"s":"")+" ("+vote.points+" puntos)</li> "}),0<d.remainingPoints&&(text+="<li> Sin usar "+d.remainingPoints+" punto"+(1<d.remainingPoints?"s":"")+"</li> ")),text+="</ul></li></ul></li>",text+="</ul>",d.text=text}),renderGraph("viz-shape",simulationBallots),runRound(simulationBallots,0,.2)}function drawCandidates(w,xmid,ymid){let scaledw=w*widthSettings,xstart=scaleXSettings(xmid)-scaledw/2,xend=scaleXSettings(xmid)+scaledw/2,drag=(candidates.forEach(d=>{d.x=d.index*scaledw+xstart,d.y=scaleYSettings(ymid)}),()=>{let dragXScale=d3.scaleLinear().domain([xstart,xend]).range([xstart,xend]).clamp(!0);return d3.drag().on("start",function(event,d){d3.select(this).raise().attr("stroke",null).attr("r",10).style("cursor","grabbing"),clearDescriptionText()}).on("drag",function(event,d){d3.select(this).attr("cx",d.x=dragXScale(event.x)),d.index=(d.x-xstart)/scaledw}).on("end",function(event,d){d3.select(this).attr("stroke","black").attr("r",6).style("cursor","grab"),updateSimulationInit()})});function drawCandSliders(){svgSettings.selectAll(".candidates").data(candidates).join("circle").attr("class","candidates").attr("cx",d=>d.x).attr("cy",d=>d.y).attr("r",6).attr("id",(d,i)=>"candidate"+i).call(drag()).on("contextmenu",(event,d)=>{event.preventDefault(),candidates.length<=2||(event.currentTarget.remove(),candidates.splice(d.id,1),candidates.forEach((d,i)=>{d.id=i}),svgSettings.selectAll(".candidates").transition().duration(500).attr("fill",(d,i)=>scaleColor[i]).call(updateSimulationInit),clearDescriptionText())}).attr("fill",(d,i)=>scaleColor[i]).attr("stroke","black").on("mouseover",function(event,d){tooltip.transition().duration(80).style("display","block").style("opacity",1).text(parties[d.id]).style("left",event.pageX-15+"px").style("top",event.pageY+15+"px").transition().duration(3e4).style("opacity",0).transition().delay(1e3).style("display","none")}).on("mouseout",function(e){tooltip.style("opacity",0).style("display","none")}).style("cursor","grab")}svgSettings.select("#rectslider").node()||svgSettings.append("rect").attr("x",xstart).attr("y",scaleYSettings(ymid-.02)).attr("width",scaledw).attr("height",scaleYSettings(.04)).attr("fill","grey").attr("opacity","0.1").on("click",(event,d)=>{5<=candidates.length||(console.log(candidates),event=(event.x-xstart)/scaledw,candidates.push({index:event,id:candidates.length,x:event*scaledw+xstart,y:scaleYSettings(ymid)}),clearDescriptionText(),updateSimulationInit(),drawCandSliders(),console.log(candidates))}).attr("id","rectslider").style("cursor","copy"),drawCandSliders()}function getBimodalGaussianLine(w,h,xcenter,ycenter){w=widthSettings*w,h=heightSettings*h,xcenter=scaleXSettings(xcenter),ycenter=scaleYSettings(ycenter);function normal(mean,variance){let predicate=1/Math.sqrt(2*variance*Math.PI);return function(x){return predicate*Math.exp(-Math.pow(x-mean,2)/(2*variance))}}var xseries=[];xseries.push(-.5);for(var i=0;i<=1e3;i++)xseries.push(+i/1e3-.5);xseries.push(.5);let normalTransform1=normal(-.25,.25/8),normalTransform2=normal(.25,.25/8),yseries=xseries.map(d=>normalTransform1(d)+normalTransform2(d)-.65),max=Math.max(...yseries);(yseries=yseries.map(d=>d/max))[0]=.1,yseries[1002]=.1;var combinedSeries=d3.zip(xseries,yseries);return[d3.line().x(d=>d[0]*w+xcenter).y(d=>(1-d[1])*h+ycenter),combinedSeries]}function clearDescriptionText(){d3.select("#description").style("opacity",0).style("width","0vw")}function drawSimulation(){let simline,series;"gauss"==simdistrib&&([simline,series]=function(w,h,xcenter,ycenter){w=widthSettings*w,h=heightSettings*h,xcenter=scaleXSettings(xcenter),ycenter=scaleYSettings(ycenter);var xseries=[];xseries.push(-.5);for(var i=0;i<=1e3;i++)xseries.push(+i/1e3-.5);xseries.push(.5);let normalTransform=function(mean,variance){let predicate=1/Math.sqrt(2*variance*Math.PI);return function(x){return predicate*Math.exp(-Math.pow(x-mean,2)/(2*variance))}}(0,.5/8),yseries=xseries.map(d=>normalTransform(d)),max=Math.max(...yseries);(yseries=yseries.map(d=>d/max))[0]=.1,yseries[1002]=.1;var combinedSeries=d3.zip(xseries,yseries);return[d3.line().x(d=>d[0]*w+xcenter).y(d=>(1-d[1])*h+ycenter),combinedSeries]}(.85,.6,.5,.2)),"bimodgauss"==simdistrib&&([simline,series]=getBimodalGaussianLine(.85,.6,.5,.2)),"uniform"==simdistrib&&([simline,series]=function(w,h,xcenter,ycenter){w=widthSettings*w,h=heightSettings*h,xcenter=scaleXSettings(xcenter),ycenter=scaleYSettings(ycenter);var xseries=[];xseries.push(-.5);for(var i=0;i<=1e3;i++)xseries.push(+i/1e3-.5);xseries.push(.5);(yseries=xseries.map(d=>.5))[0]=.1,yseries[1002]=.1;var yseries=d3.zip(xseries,yseries);return[d3.line().x(d=>d[0]*w+xcenter).y(d=>(1-d[1])*h+ycenter),yseries]}(.85,.6,.5,.2)),"leftskew"==simdistrib&&([simline,series]=function(w,h,xcenter,ycenter){w=widthSettings*w,h=heightSettings*h,xcenter=scaleXSettings(xcenter),ycenter=scaleYSettings(ycenter);var xseries=[];xseries.push(-.5);for(var i=0;i<=1e3;i++)xseries.push(+i/1e3-.5);xseries.push(.5);let yseries=xseries.map(d=>stdlib.base.dists.beta.pdf(d+.5,4,2)),max=Math.max(...yseries);(yseries=yseries.map(d=>d/max+.1))[0]=.1,yseries[1002]=.1;var combinedSeries=d3.zip(xseries,yseries);return[d3.line().x(d=>d[0]*w+xcenter).y(d=>(1-d[1])*h+ycenter),combinedSeries]}(.85,.6,.5,.2)),"rightskew"==simdistrib&&([simline,series]=function(w,h,xcenter,ycenter){w=widthSettings*w,h=heightSettings*h,xcenter=scaleXSettings(xcenter),ycenter=scaleYSettings(ycenter);var xseries=[];xseries.push(-.5);for(var i=0;i<=1e3;i++)xseries.push(+i/1e3-.5);xseries.push(.5);let yseries=xseries.map(d=>stdlib.base.dists.beta.pdf(d+.5,2,4)),max=Math.max(...yseries);(yseries=yseries.map(d=>d/max+.1))[0]=.1,yseries[1002]=.1;var combinedSeries=d3.zip(xseries,yseries);return[d3.line().x(d=>d[0]*w+xcenter).y(d=>(1-d[1])*h+ycenter),combinedSeries]}(.85,.6,.5,.2)),drawCandidates(.85,.5,.8),(svgSettings.select("#simline").node()?svgSettings.select("#simline"):svgSettings.append("path")).datum(series).transition().duration(1e3).attr("d",simline).attr("fill","url(#redbluegrad").attr("id","simline")}updateChoices=function(){var simchoiceDesc=document.getElementById("simchoice-description"),idf=IdeologicalDistributionFeatures[simdistrib],simchoiceDesc=(simchoiceDesc.innerText=idf.description,document.getElementById("simcontext-description")),idf=VotingContextFeatures[simcontext];simchoiceDesc.innerText=idf.description},simChoiceSelect.onchange=()=>{clearDescriptionText(),simdistrib=simChoiceSelect.value,drawSimulation(),clearGraph(),updateSimulationInit()},simContextSelect.onchange=()=>{clearDescriptionText(),simcontext=simContextSelect.value,drawSimulation(),clearGraph(),updateSimulationInit()},simSizeInput.onchange=()=>{clearDescriptionText(),simsize=parseInt(simSizeInput.value),drawSimulation(),clearGraph(),updateSimulationInit()};d3.select("body").style("opacity",0).transition().duration(1e3).style("opacity",1),updateChoices(),drawSimulation(),clearGraph(),updateSimulationInit(),r.onclick=()=>{runRound(simulationBallots,1,.6,!1)},width.onclick=()=>{runRound(simulationBallots,1,.6,!0)}});
